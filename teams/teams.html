<!DOCTYPE html>
<html lang="pl">
<head>
    <link rel="icon" href="../cropped-logo-1.png" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista dru≈ºyn i zawodnik√≥w</title>
    <link rel="stylesheet" href="../navigation.css">
    <link rel="stylesheet" href="style_teams.css">
</head>
<body>
<script src="../navigation.js"></script>
<div class="container">
    <h1>Lista dru≈ºyn i zawodnik√≥w</h1>
    <div style="display: flex; justify-content: center; align-items: center; gap: 0.5rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
        <button id="prev-class-btn" class="refresh-btn" style="padding: 8px 14px;" aria-label="Poprzednia klasa">&#8592;</button>
        <select id="class-select" class="refresh-btn" style="padding: 8px 16px; min-width: 110px; color: var(--dark); background: #fff; border: 1px solid var(--primary); border-radius: 50px; font-weight: 500; margin: 0 8px;">
            <option value="">Wybierz klasƒô...</option>
        </select>
        <button id="next-class-btn" class="refresh-btn" style="padding: 8px 14px;" aria-label="Nastƒôpna klasa">&#8594;</button>
    </div>
    <div id="loading" class="loading">≈Åadowanie danych...</div>
    <div id="error" class="error" style="display: none;"></div>
    <div id="teams-list"></div>
</div>
<script>
const SPREADSHEET_ID = '15q06r0qd-UE8Wna1tRJxlQ2biZz-PIPxNntGX4uQC0w';
const TEAMS_RANGE = 'teams!A:E';
const DISCIPLINES_RANGE = 'teams!H1:N15';
const SCHEDULE_RANGE = 'Dane_Strona_Siatka!Q:AA';
const BASKETBALL_RANGE = 'Dane_Strona!L:R';
const SOCCER_RANGE = 'Dane_Strona_Noga!V2:AE14'; 

// const SOCCER_RANGE = 'Dane_Strona_Noga!V2:AE14';

const FULL_UPDATE_INTERVAL = 300000; // 5 minutes

let classOrder = [];
let classTeams = {};
let currentClassIdx = 0;
let disciplinesData = {}; // { [klasa]: { basket: bool, volley: bool, soccer: bool, members: [] } }
let scheduleData = []; // przechowuj dane terminarza
let lastUpdateTime = null;
let basketballRefreshInterval;

function loadTeams() {
    console.log('%c[Teams] Starting data fetch...', 'color: #4361ee; font-weight: bold;');
    console.group('Data Fetching');
    
    document.getElementById('loading').style.display = 'block';
    document.getElementById('error').style.display = 'none';
    document.getElementById('teams-list').innerHTML = '';
    
    // Reset all data
    classOrder = [];
    classTeams = {};
    currentClassIdx = 0;
    disciplinesData = {};
    scheduleData = [];

    Promise.all([
        fetch(`https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&sheet=${TEAMS_RANGE.split('!')[0]}&range=${TEAMS_RANGE.split('!')[1]}`)
            .then(response => {
                console.group('%cüìä Teams Data', 'color: #4361ee');
                console.log('%c‚úì Status:', 'color: #2ed573', response.status);
                console.log('%c‚úì Range:', 'color: #2ed573', TEAMS_RANGE);
                console.log('%c‚úì URL:', 'color: #2ed573', response.url);
                console.groupEnd();
                return response.text();
            }),
        fetch(`https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&sheet=${DISCIPLINES_RANGE.split('!')[0]}&range=${DISCIPLINES_RANGE.split('!')[1]}`)
            .then(response => {
                console.group('%cüéØ Disciplines Data', 'color: #4361ee');
                console.log('%c‚úì Status:', 'color: #2ed573', response.status);
                console.log('%c‚úì Range:', 'color: #2ed573', DISCIPLINES_RANGE);
                console.log('%c‚úì URL:', 'color: #2ed573', response.url);
                console.groupEnd();
                return response.text();
            }),
        fetch(`https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&sheet=${SCHEDULE_RANGE.split('!')[0]}&range=${SCHEDULE_RANGE.split('!')[1]}`)
            .then(response => {
                console.group('%cüèê Volleyball Schedule', 'color: #4361ee');
                console.log('%c‚úì Status:', 'color: #2ed573', response.status);
                console.log('%c‚úì Range:', 'color: #2ed573', SCHEDULE_RANGE);
                console.log('%c‚úì URL:', 'color: #2ed573', response.url);
                console.groupEnd();
                return response.text();
            }),
        fetch(`https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&sheet=${BASKETBALL_RANGE.split('!')[0]}&range=${BASKETBALL_RANGE.split('!')[1]}`)
            .then((response) => { // Fixed: Added parentheses around response parameter
                console.group('%cüèÄ Basketball Schedule', 'color: #4361ee');
                console.log('%c‚úì Status:', 'color: #2ed573', response.status);
                console.log('%c‚úì Range:', 'color: #2ed573', BASKETBALL_RANGE);
                console.log('%c‚úì URL:', 'color: #2ed573', response.url);
                console.groupEnd();
                return response.text();
            }),
        fetch(`https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&sheet=${SOCCER_RANGE.split('!')[0]}&range=${SOCCER_RANGE.split('!')[1]}`)
            .then(response => {
                console.group('%c‚öΩ Soccer Schedule', 'color: #4361ee');
                console.log('%c‚úì Status:', 'color: #2ed573', response.status);
                console.log('%c‚úì Range:', 'color: #2ed573', SOCCER_RANGE);
                console.log('%c‚úì URL:', 'color: #2ed573', response.url);
                console.groupEnd();
                return response.text();
            }),
        fetch(`https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&sheet=Main_Ranking&range=A1:F16`)
            .then(response => response.text())
            .then(csv => {
                const data = csvToArray(csv);
                console.group('%cüèÜ Main Ranking Data', 'color: #4361ee');
                console.log('%c‚úì Raw data:', 'color: #2ed573', data);
                
                // Process and store main table data - skip header row (index 0)
                window.mainTableData = data.slice(1).map(row => ({
                    class: row[0] || '',
                    teamName: row[1] || '',
                    basketballPoints: parseInt(row[2] || '0'),
                    volleyballPoints: parseInt(row[3] || '0'),
                    footballPoints: parseInt(row[4] || '0'),
                    totalPoints: parseInt(row[5] || '0')
                }));
                
                console.log('%c‚úì Processed data:', 'color: #2ed573', window.mainTableData);
                console.table(window.mainTableData);
                console.groupEnd();
            })
    ]) // Fixed: Added missing closing bracket
    .then(([teamsCsv, discCsv, scheduleCsv, basketballCsv, soccerCsv]) => {
        console.groupEnd();
        console.group('%cüìù Data Processing', 'color: #4361ee; font-weight: bold');
        
        document.getElementById('loading').style.display = 'none';
        
        const teamsData = csvToArray(teamsCsv);
        console.group('%cüìä Teams Data', 'color: #4361ee');
        console.log('%c‚úì Rows:', 'color: #2ed573', teamsData.length);
        console.log('%c‚úì Columns:', 'color: #2ed573', teamsData[0]?.length || 0);
        console.log('%c‚úì Headers:', 'color: #2ed573', teamsData[0]);
        console.log('%c‚úì Sample data:', 'color: #2ed573', teamsData.slice(1, 3));
        console.groupEnd();
        
        const discData = csvToArray(discCsv);
        console.group('%cüéØ Disciplines Data', 'color: #4361ee');
        console.log('%c‚úì Rows:', 'color: #2ed573', discData.length);
        console.log('%c‚úì Columns:', 'color: #2ed573', discData[0]?.length || 0);
        console.log('%c‚úì Headers:', 'color: #2ed573', discData[0]);
        console.log('%c‚úì Sample data:', 'color: #2ed573', discData.slice(1, 3));
        console.groupEnd();
        
        scheduleData = csvToArray(scheduleCsv);
        console.group('%cüèê Volleyball Schedule', 'color: #4361ee');
        console.log('%c‚úì Rows:', 'color: #2ed573', scheduleData.length);
        console.log('%c‚úì Columns:', 'color: #2ed573', scheduleData[0]?.length || 0);
        console.log('%c‚úì Headers:', 'color: #2ed573', scheduleData[0]);
        console.log('%c‚úì Sample data:', 'color: #2ed573', scheduleData.slice(1, 3));
        console.groupEnd();
        
        window.basketballData = csvToArray(basketballCsv);
        console.group('%cüèÄ Basketball Schedule', 'color: #4361ee');
        console.log('%c‚úì Rows:', 'color: #2ed573', window.basketballData.length);
        console.log('%c‚úì Columns:', 'color: #2ed573', window.basketballData[0]?.length || 0);
        console.log('%c‚úì Headers:', 'color: #2ed573', window.basketballData[0]);
        console.log('%c‚úì Sample data:', 'color: #2ed573', window.basketballData.slice(1, 3));
        console.groupEnd();
        
        window.soccerData = csvToArray(soccerCsv);
        console.group('%c‚öΩ Soccer Schedule', 'color: #4361ee');
        console.log('%c‚úì Rows:', 'color: #2ed573', window.soccerData.length);
        console.log('%c‚úì Columns:', 'color: #2ed573', window.soccerData[0]?.length || 0);
        console.log('%c‚úì Headers:', 'color: #2ed573', window.soccerData[0]);
        console.log('%c‚úì Sample data:', 'color: #2ed573', window.soccerData.slice(1, 3));
        console.groupEnd();

        prepareTeams(teamsData);
        prepareDisciplines(discData, teamsData);
        populateDropdown();
        showCurrentClass();
        
        console.groupEnd();
        console.log('%c‚úì All data loaded and processed successfully!', 'color: #2ed573; font-weight: bold');
    })
    .catch(error => {
        console.groupEnd();
        console.group('%c‚ùå Error Details', 'color: #ff4757; font-weight: bold');
        console.error('%c‚úï Message:', 'color: #ff4757', error.message);
        console.error('%c‚úï Stack:', 'color: #ff4757', error.stack);
        console.error('%c‚úï Full error:', 'color: #ff4757', error);
        console.groupEnd();
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error').style.display = 'block';
        document.getElementById('error').textContent = 'WystƒÖpi≈Ç b≈ÇƒÖd: ' + error.message;
    });
}

function csvToArray(csvText) {
    const lines = csvText.split('\n').filter(l => l.trim().length > 0);
    return lines.map(line => {
        const values = [];
        let current = '';
        let inQuotes = false;
        for (let i = 0; i < line.length; i++) {
            const char = line[i];
            if (char === '"') {
                inQuotes = !inQuotes;
            } else if (char === ',' && !inQuotes) {
                values.push(current);
                current = '';
            } else {
                current += char;
            }
        }
        values.push(current);
        return values;
    });
}

function prepareTeams(data) {
    if (!data || data.length < 2) {
        document.getElementById('error').style.display = 'block';
        document.getElementById('error').textContent = 'Brak danych do wy≈õwietlenia';
        return;
    }
    const headers = data[0];
    const nameIdx = headers.findIndex(h => h.toLowerCase().includes('nazwa'));
    const imieIdx = headers.findIndex(h => h.toLowerCase().includes('imiƒô'));
    const nazwiskoIdx = headers.findIndex(h => h.toLowerCase().includes('nazwisko'));
    const klasaIdx = headers.findIndex(h => h.toLowerCase().includes('klasa'));
    const kapitanIdx = headers.findIndex(h => h.toLowerCase().includes('kapitan'));
    classTeams = {};
    for (let i = 1; i < data.length; i++) {
        const row = data[i];
        const klasa = row[klasaIdx] || 'Brak klasy';
        const teamName = row[nameIdx] || 'Nieznana dru≈ºyna';
        if (!classTeams[klasa]) classTeams[klasa] = {};
        if (!classTeams[klasa][teamName]) classTeams[klasa][teamName] = [];
        classTeams[klasa][teamName].push({
            imie: row[imieIdx] || '',
            nazwisko: row[nazwiskoIdx] || '',
            kapitan: (row[kapitanIdx] || '').toLowerCase() === 'true'
        });
    }
    classOrder = Object.keys(classTeams);
    currentClassIdx = 0;
}

function prepareDisciplines(discData, teamsData) {
    // discData: [ [klasa, nazwa, basket, volley, soccer, grupa_basket, grupa_volley], ... ]
    // teamsData: do pobrania zawodnik√≥w
    // Nag≈Ç√≥wki: H1: Klasa, I1: Nazwa, J1: Koszyk√≥wka, K1: Siatk√≥wka, L1: Pi≈Çka No≈ºna, M1: Grupa Koszyk√≥wka, N1: Grupa Siatk√≥wka
    const header = discData[0];
    const klasaIdx = 0;
    const nazwaIdx = 1;
    const basketIdx = 2;
    const volleyIdx = 3;
    const soccerIdx = 4;
    const grupaBasketIdx = 5;
    const grupaVolleyIdx = 6;

    // Zbuduj mapƒô: klasa-nazwa => { basket, volley, soccer, grupaBasket, grupaVolley }
    const discMap = {};
    for (let i = 1; i < discData.length; i++) {
        const row = discData[i];
        const klasa = row[klasaIdx];
        const nazwa = row[nazwaIdx];
        discMap[`${klasa}|||${nazwa}`] = {
            basket: row[basketIdx] === 'TRUE',
            volley: row[volleyIdx] === 'TRUE',
            soccer: row[soccerIdx] === 'TRUE',
            grupaBasket: row[grupaBasketIdx] && row[grupaBasketIdx] !== 'NULL' && row[grupaBasketIdx] !== 'FALSE' ? row[grupaBasketIdx] : null,
            grupaVolley: row[grupaVolleyIdx] && row[grupaVolleyIdx] !== 'NULL' && row[grupaVolleyIdx] !== 'FALSE' ? row[grupaVolleyIdx] : null
        };
    }

    // Zbuduj mapƒô zawodnik√≥w: klasa-nazwa => [zawodnicy]
    const headers = teamsData[0];
    const nameIdx = headers.findIndex(h => h.toLowerCase().includes('nazwa'));
    const imieIdx = headers.findIndex(h => h.toLowerCase().includes('imiƒô'));
    const nazwiskoIdx = headers.findIndex(h => h.toLowerCase().includes('nazwisko'));
    const klasaIdxT = headers.findIndex(h => h.toLowerCase().includes('klasa'));
    const membersMap = {};
    for (let i = 1; i < teamsData.length; i++) {
        const row = teamsData[i];
        const klasa = row[klasaIdxT] || 'Brak klasy';
        const nazwa = row[nameIdx] || 'Nieznana dru≈ºyna';
        const key = `${klasa}|||${nazwa}`;
        if (!membersMap[key]) membersMap[key] = [];
        membersMap[key].push(`${row[imieIdx] || ''} ${row[nazwiskoIdx] || ''}`.trim());
    }

    // Po≈ÇƒÖcz dane
    disciplinesData = {};
    for (const key in discMap) {
        const [klasa, nazwa] = key.split('|||');
        if (!disciplinesData[klasa]) disciplinesData[klasa] = {};
        disciplinesData[klasa][nazwa] = {
            ...discMap[key],
            members: membersMap[key] || []
        };
    }
}

function populateDropdown() {
    const select = document.getElementById('class-select');
    select.innerHTML = '<option value="">Wybierz klasƒô...</option>';
    classOrder.forEach((klasa, idx) => {
        const option = document.createElement('option');
        option.value = idx;
        option.textContent = klasa;
        select.appendChild(option);
    });
    select.value = classOrder.length > 0 ? currentClassIdx : '';
}

function showCurrentClass() {
    console.log(`%c[Teams] Showing class: ${classOrder[currentClassIdx]}`, 'color: #4361ee');
    const teamsList = document.getElementById('teams-list');
    teamsList.innerHTML = '';
    if (classOrder.length === 0) return;
    
    let matches = [];
    
    document.getElementById('class-select').value = currentClassIdx;
    const klasa = classOrder[currentClassIdx];
    const teams = classTeams[klasa];
    const card = document.createElement('div');
    card.className = 'card';
    card.style.display = 'flex';
    card.style.flexDirection = 'row';
    card.style.alignItems = 'flex-start';
    card.style.justifyContent = 'space-between';

    const leftDiv = document.createElement('div');
    leftDiv.style.flex = '1 1 0%';
    leftDiv.style.width = '100%';

    for (const [teamName, members] of Object.entries(teams)) {
        const teamHeader = document.createElement('h2');
        teamHeader.textContent = `${klasa} - ${teamName}`;
        leftDiv.appendChild(teamHeader);

        let dyscypliny = '';
        const disc = (disciplinesData[klasa] && disciplinesData[klasa][teamName]) || {};
        dyscypliny += disc.basket ? 'üèÄ ' : '';
        dyscypliny += disc.volley ? 'üèê ' : '';
        dyscypliny += disc.soccer ? '‚öΩ ' : '';
        if (!dyscypliny) dyscypliny = '‚Äî';
        const dyscDiv = document.createElement('div');
        dyscDiv.style.marginBottom = '0.5em';
        dyscDiv.textContent = `Dyscypliny: ${dyscypliny}`;
        leftDiv.appendChild(dyscDiv);

        // Grupy (bez zmian)
        if (disc.grupaBasket || disc.grupaVolley) {
            const grupyDiv = document.createElement('div');
            grupyDiv.style.marginBottom = '0.5em';
            grupyDiv.style.display = 'flex';
            grupyDiv.style.flexDirection = 'column';
            grupyDiv.style.gap = '2px';
            if (disc.grupaBasket) {
                const basketDiv = document.createElement('span');
                basketDiv.style.display = 'block';
                basketDiv.style.background = 'rgba(67,97,238,0.07)';
                basketDiv.style.borderRadius = '6px';
                basketDiv.style.padding = '2px 8px';
                basketDiv.style.marginBottom = '2px';
                basketDiv.style.fontSize = '0.98em';
                basketDiv.textContent = `Koszyk√≥wka: ${disc.grupaBasket}`;
                grupyDiv.appendChild(basketDiv);
            }
            if (disc.grupaVolley) {
                const volleyDiv = document.createElement('span');
                volleyDiv.style.display = 'block';
                volleyDiv.style.background = 'rgba(67,97,238,0.07)';
                volleyDiv.style.borderRadius = '6px';
                volleyDiv.style.padding = '2px 8px';
                volleyDiv.style.fontSize = '0.98em';
                volleyDiv.textContent = `Siatk√≥wka: ${disc.grupaVolley}`;
                grupyDiv.appendChild(volleyDiv);
                grupyDiv.appendChild(volleyDiv);
            }
            leftDiv.appendChild(grupyDiv);
        }

        // Lista zawodnik√≥w (bez zmian)
        const zawodnicyNaglowek = document.createElement('div');
        zawodnicyNaglowek.style.fontWeight = 'bold';
        zawodnicyNaglowek.style.marginBottom = '0.2em';
        zawodnicyNaglowek.textContent = 'Zawodnicy:';
        leftDiv.appendChild(zawodnicyNaglowek);

        const sortedMembers = [...members].sort((a, b) => {
            const nazwA = (a.nazwisko || '').toLowerCase();
            const nazwB = (b.nazwisko || '').toLowerCase();
            if (nazwA < nazwB) return -1;
            if (nazwA > nazwB) return 1;
            const imieA = (a.imie || '').toLowerCase();
            const imieB = (b.imie || '').toLowerCase();
            if (imieA < imieB) return -1;
            if (imieA > imieB) return 1;
            return 0;
        });
        const ul = document.createElement('ul');
        sortedMembers.forEach(player => {
            const li = document.createElement('li');
            li.textContent = `${player.imie} ${player.nazwisko}`;
            if (player.kapitan) {
                li.innerHTML += ' <span style="color:#4361ee;font-weight:bold;font-size:0.98em;">(kapitan)</span>';
                li.style.fontWeight = 'bold';
            }
            ul.appendChild(li);
        });
        leftDiv.appendChild(ul);

        // Stats section moved after players list
        const stats = calculateTeamStats(klasa, teamName);
        const points = calculateTeamPoints(klasa, teamName);
        
        const statsContainer = document.createElement('div');
        statsContainer.className = 'stats-container';
        statsContainer.style.marginTop = '1.5rem';
        statsContainer.style.marginBottom = '2rem';
        statsContainer.style.padding = '1rem';
        statsContainer.style.backgroundColor = '#f8f9fa';
        statsContainer.style.borderRadius = '12px';
        statsContainer.style.boxShadow = '0 2px 4px rgba(0,0,0,0.05)';
        
        const statsTitle = document.createElement('h3');
        const position = getTeamPosition(klasa, teamName);
        // Get total points from main ranking
        const mainRankingData = window.mainTableData?.find(row => 
            row.class === klasa && row.teamName === teamName
        );
        
        statsTitle.innerHTML = `
            <div style="margin-bottom: 0.5rem">üìä Statystyki dru≈ºyny</div>
            ${position ? `
                <div style="
                    font-size: 0.95rem;
                    color: ${position === 1 ? '#ffd700' : // z≈Çoto
                           position === 2 ? '#C0C0C0' : // srebro
                           position === 3 ? '#CD7F32' : // brƒÖz
                           'var(--primary)'};
                    font-weight: ${position <= 3 ? '600' : '500'};
                    padding: 4px 12px;
                    background: ${position === 1 ? 'rgba(255,215,0,0.1)' : // z≈Çoto
                                position === 2 ? 'rgba(192,192,192,0.1)' : // srebro
                                position === 3 ? 'rgba(205,127,50,0.1)' : // brƒÖz
                                'rgba(67,97,238,0.1)'};
                    border-radius: 6px;
                    display: inline-block;
                    margin-bottom: 0.5rem;
                ">
                    ${position}. miejsce w klasyfikacji generalnej
                </div>
                ${mainRankingData ? `
                <div style="
                    font-size: 0.9rem;
                    padding: 4px 12px;
                    background: rgba(67,97,238,0.05);
                    border-radius: 6px;
                    display: inline-block;
                    margin-left: 8px;
                ">
                    üèÜ ≈ÅƒÖczna liczba punkt√≥w: ${mainRankingData.totalPoints}
                    (${[
                        disc.basket ? `üèÄ ${mainRankingData.basketballPoints}` : null,
                        disc.volley ? `üèê ${mainRankingData.volleyballPoints}` : null,
                        disc.soccer ? `‚öΩ ${mainRankingData.footballPoints}` : null
                    ].filter(Boolean).join(' + ')})
                </div>` : ''}
            ` : ''}
        `;
        statsTitle.style.marginBottom = '1rem';
        statsTitle.style.color = 'var(--primary)';
        statsTitle.style.fontSize = '1.1rem';
        statsContainer.appendChild(statsTitle);
        
        const statsContent = document.createElement('div');
        statsContent.style.display = 'flex';
        statsContent.style.justifyContent = 'space-around';
        statsContent.style.flexWrap = 'wrap';
        statsContent.style.gap = '1.5rem';
        
        statsContent.innerHTML = `
            ${(stats.volleyball.played || (disc.volley)) ? `
                <div style="min-width: 200px; flex: 1;">
                    <strong>üèê Siatk√≥wka:</strong>
                    <div>üèÉ Rozegrane: ${stats.volleyball.played}</div>
                    <div>ü•á Wygrane: ${stats.volleyball.won}</div>
                    <div>ü•à Przegrane: ${stats.volleyball.lost}</div>
                    <div style="color: var(--primary);">üèÜ Punkty: ${points.volleyball}</div>
                </div>
            ` : ''}
            ${(stats.basketball.played || (disc.basket)) ? `
                <div style="min-width: 200px; flex: 1;">
                    <strong>üèÄ Koszyk√≥wka:</strong>
                    <div>üèÉ Rozegrane: ${stats.basketball.played}</div>
                    <div>ü•á Wygrane: ${stats.basketball.won}</div>
                    <div>ü•à Przegrane: ${stats.basketball.lost}</div>
                    <div style="color: var(--primary);">üèÜ Punkty: ${points.basketball}</div>
                </div>
            ` : ''}
            ${(stats.soccer.played || (disc.soccer)) ? `
                <div style="min-width: 200px; flex: 1;">
                    <strong>‚öΩ Pi≈Çka no≈ºna:</strong>
                    <div>üèÉ Rozegrane: ${stats.soccer.played}</div>
                    <div>ü•á Wygrane: ${stats.soccer.won}</div>
                    <div>ü•à Przegrane: ${stats.soccer.lost}</div>
                    <div style="color: var(--primary);">üèÜ Punkty: ${points.soccer}</div>
                </div>
            ` : ''}
        `;
        
        statsContainer.appendChild(statsContent);
        leftDiv.appendChild(statsContainer);
    }

    // Dodaj logo po prawej stronie karty, wiƒôksze
    const logoDiv = document.createElement('div');
    logoDiv.style.flex = '0 0 auto';
    logoDiv.style.display = 'flex';
    logoDiv.style.alignItems = 'flex-start';
    logoDiv.style.justifyContent = 'flex-end';
    logoDiv.style.marginLeft = '32px';
    const logoImg = document.createElement('img');
    logoImg.src = `./Loga/${klasa}.png`;
    logoImg.alt = `Logo klasy ${klasa}`;
    logoImg.style.maxWidth = '180px';
    logoImg.style.maxHeight = '180px';
    logoImg.style.objectFit = 'contain';
    logoImg.style.borderRadius = '10px';
    logoImg.onerror = function() {
        this.onerror = null;
        this.src = './Loga/brak.png';
    };
    logoDiv.appendChild(logoImg);

    card.appendChild(leftDiv);
    card.appendChild(logoDiv);
    teamsList.appendChild(card);

    // --- MECZE DLA DANEJ KLASY ---
    if (scheduleData && scheduleData.length > 1) {
        // Fill matches array
        for (let i = 1; i < scheduleData.length; i++) {
            const row = scheduleData[i];
            if (!row || row.length < 9) continue;
            if (row[2] === klasa || row[8] === klasa) {
                matches.push(row);
            }
        }

        if (matches.length > 0) {
            // Add volleyball header
            const volleyballHeader = document.createElement('h2');
            volleyballHeader.textContent = 'Mecze siatk√≥wki';
            volleyballHeader.style.marginTop = '2.5rem';
            volleyballHeader.style.marginBottom = '0.5rem';
            volleyballHeader.style.color = 'var(--primary)';
            volleyballHeader.style.fontSize = '1.3rem';
            teamsList.appendChild(volleyballHeader);

            // Sortuj po dacie i godzinie
            matches.sort((a, b) => {
                // data: 0, godzina: 1
                const [dA, mA, yA] = a[0].split('.').map(Number);
                const [dB, mB, yB] = b[0].split('.').map(Number);
                const dateA = new Date(yA, mA - 1, dA);
                const dateB = new Date(yB, mB - 1, dB);
                if (dateA.getTime() !== dateB.getTime()) return dateA - dateB;
                // por√≥wnaj godziny
                const [hA, minA] = (a[1] || '').split(':').map(Number);
                const [hB, minB] = (b[1] || '').split(':').map(Number);
                return (hA * 60 + (minA || 0)) - (hB * 60 + (minB || 0));
            });

            matches.forEach(match => {
                // Indeksy: 0-data, 1-godzina, 2-klasa1, 3-dru≈ºyna1, 4-sets1, 5-sets2, 6-points, 7-dru≈ºyna2, 8-klasa2, 9-court, 10-header
                const matchDiv = document.createElement('div');
                matchDiv.className = 'match-container';
                matchDiv.setAttribute('data-date', match[0]);
                matchDiv.setAttribute('data-time', match[1]);

                // Nag≈Ç√≥wek meczu je≈õli istnieje
                if (match[10] && match[10].trim() !== '') {
                    const headerDiv = document.createElement('div');
                    headerDiv.className = 'match-header';
                    headerDiv.textContent = match[10];
                    matchDiv.appendChild(headerDiv);
                }

                // Team 1
                const team1Div = document.createElement('div');
                team1Div.className = 'team home';
                const team1Class = match[2] || '';
                const team1Name = match[3] || '';
                team1Div.textContent = team1Class && team1Name ? `${team1Class} - ${team1Name}` : team1Name;
                // Pod≈õwietl je≈õli to dru≈ºyna z aktualnej klasy
                if (team1Class === klasa) {
                    team1Div.style.background = 'rgba(67,97,238,0.18)';
                    team1Div.style.color = 'var(--dark)';
                    team1Div.style.fontWeight = 'bold';
                }
                matchDiv.appendChild(team1Div);

                // Score container
                const scoreDiv = document.createElement('div');
                scoreDiv.className = 'score';

                const hasScores = match[4] && match[5] && (match[4].trim() !== '' || match[5].trim() !== '');

                if (hasScores) {
                    const scoreValue = document.createElement('div');
                    scoreValue.className = 'score-value';
                    scoreValue.textContent = `${match[4] || '0'} : ${match[5] || '0'}`;
                    scoreDiv.appendChild(scoreValue);

                    if (match[6] && match[6].trim() !== '') {
                        const pointsDiv = document.createElement('div');
                        pointsDiv.className = 'points-details';
                        pointsDiv.textContent = match[6];
                        scoreDiv.appendChild(pointsDiv);
                    }
                } else {
                    const vsText = document.createElement('div');
                    vsText.textContent = 'vs';
                    scoreDiv.appendChild(vsText);

                    // Coming Up badge
                    const comingUpBadge = document.createElement('div');
                    comingUpBadge.className = 'coming-up-badge';
                    comingUpBadge.textContent = 'Coming Up';
                    matchDiv.appendChild(comingUpBadge);
                }

                matchDiv.appendChild(scoreDiv);

                // Team 2
                const team2Div = document.createElement('div');
                team2Div.className = 'team away';
                const team2Class = match[8] || '';
                const team2Name = match[7] || '';
                team2Div.textContent = team2Class && team2Name ? `${team2Class} - ${team2Name}` : team2Name;
                // Pod≈õwietl je≈õli to dru≈ºyna z aktualnej klasy
                if (team2Class === klasa) {
                    team2Div.style.background = 'rgba(67,97,238,0.18)';
                    team2Div.style.color = 'var(--dark)';
                    team2Div.style.fontWeight = 'bold';
                }
                matchDiv.appendChild(team2Div);

                // Match info
                const infoDiv = document.createElement('div');
                infoDiv.className = 'match-info';

                // Najpierw dzie≈Ñ (data z ikonkƒÖ), potem godzina (z ikonkƒÖ), na ko≈Ñcu boisko
                // Data
                const dateDiv = document.createElement('div');
                dateDiv.className = 'match-date';
                dateDiv.innerHTML = `
                    <svg class="icon" style="margin-right:2px;" xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                        <rect x="3" y="6" width="18" height="15" rx="2"></rect>
                        <line x1="16" y1="3" x2="16" y2="7"></line>
                        <line x1="8" y1="3" x2="8" y2="7"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    ${match[0]}
                `;
                infoDiv.appendChild(dateDiv);

                // Godzina
                const timeDiv = document.createElement('div');
                timeDiv.className = 'match-time';
                timeDiv.innerHTML = `
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    ${match[1]}
                `;
                infoDiv.appendChild(timeDiv);

                // Boisko
                if (match[9] && match[9].trim() !== '') {
                    const courtDiv = document.createElement('div');
                    courtDiv.className = 'match-location';
                    courtDiv.innerHTML = `
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                            <path d="M12 4v16"></path>
                            <path d="M2 8h20"></path>
                            <path d="M2 16h20"></path>
                        </svg>
                        Boisko ${match[9]}
                    `;
                    infoDiv.appendChild(courtDiv);
                }

                matchDiv.appendChild(infoDiv);

                teamsList.appendChild(matchDiv);
            });
        }
    }

    // Always call renderBasketballPlan regardless of matches length
    renderBasketballPlan(klasa, teams);
    renderSoccerPlan(klasa, teams);
    
    updateNavButtons();
}

        // --- KONIEC planu siatk√≥wki ---

        // === PLAN MECZ√ìW KOSZYK√ìWKI (jak w terminarz.html z koszyk√≥wka) ===
        // Funkcja renderujƒÖca plan koszyk√≥wki dla danej klasy (przenie≈õ poza showCurrentClass)
        function renderBasketballPlan(klasa, teams) {
            console.log(`%c[Teams] Rendering basketball matches for class: ${klasa}`, 'color: #4361ee');
            const teamsList = document.getElementById('teams-list');
            
            const basketballData = window.basketballData || [];
            const matches = [];
            
            for (let i = 1; i < basketballData.length; i++) {
                const row = basketballData[i];
                if (!row || row.length < 6) continue;
                
                const mappedRow = [
                    row[0],  // Data
                    row[1],  // Godzina
                    (row[2] || '').split(' - ')[0],  // Klasa team 1
                    (row[2] || '').split(' - ')[1],  // Nazwa team 1
                    row[3],  // Wynik team 1
                    row[4],  // Wynik team 2
                    '',     // points (empty)
                    (row[5] || '').split(' - ')[1],  // Nazwa team 2
                    (row[5] || '').split(' - ')[0],  // Klasa team 2
                    '',     // court (empty)
                    row[6] || '' // Nag≈Ç√≥wek
                ];
                
                if (mappedRow[2] === klasa || mappedRow[8] === klasa) {
                    matches.push(mappedRow);
                }
            }

            if (matches.length > 0) {
                const basketballHeader = document.createElement('h2');
                basketballHeader.textContent = 'Mecze koszyk√≥wki';
                basketballHeader.style.marginTop = '2.5rem';
                basketballHeader.style.marginBottom = '0.5rem';
                basketballHeader.style.color = 'var(--primary)';
                basketballHeader.style.fontSize = '1.3rem';
                teamsList.appendChild(basketballHeader);

                displayBasketballMatches(matches, teamsList, klasa);
            }
        }

        function displayBasketballMatches(matches, container, klasa) {
            console.log(`%c[Teams] Displaying ${matches.length} matches for class ${klasa}`, 'color: #4361ee');
            
            // Sort matches by date and time
            matches.sort((a, b) => {
                const [dayA, monthA, yearA] = a[0].split('.').map(Number);
                const [dayB, monthB, yearB] = b[0].split('.').map(Number);
                const dateA = new Date(yearA, monthA-1, dayA);
                const dateB = new Date(yearB, monthB-1, dayB);
                if (dateA.getTime() !== dateB.getTime()) return dateA - dateB;
                const [hA, minA] = (a[1] || '').split(':').map(Number);
                const [hB, minB] = (b[1] || '').split(':').map(Number);
                return (hA * 60 + (minA || 0)) - (hB * 60 + (minB || 0));
            });

            matches.forEach(match => {
                // Indeksy: 0-data, 1-godzina, 2-klasa1, 3-dru≈ºyna1, 4-sets1, 5-sets2, 6-points, 7-dru≈ºyna2, 8-klasa2, 9-court, 10-header
                const matchDiv = document.createElement('div');
                matchDiv.className = 'match-container';
                matchDiv.setAttribute('data-date', match[0]);
                matchDiv.setAttribute('data-time', match[1]);

                // Nag≈Ç√≥wek meczu je≈õli istnieje
                if (match[10] && match[10].trim() !== '') {
                    const headerDiv = document.createElement('div');
                    headerDiv.className = 'match-header';
                    headerDiv.textContent = match[10];
                    matchDiv.appendChild(headerDiv);
                }

                // Team 1
                const team1Div = document.createElement('div');
                team1Div.className = 'team home';
                const team1Class = match[2] || '';
                const team1Name = match[3] || '';
                team1Div.textContent = team1Class && team1Name ? `${team1Class} - ${team1Name}` : team1Name;
                // Pod≈õwietl je≈õli to dru≈ºyna z aktualnej klasy
                if (team1Class === klasa) {
                    team1Div.style.background = 'rgba(67,97,238,0.18)';
                    team1Div.style.color = 'var(--dark)';
                    team1Div.style.fontWeight = 'bold';
                }
                matchDiv.appendChild(team1Div);

                // Score container
                const scoreDiv = document.createElement('div');
                scoreDiv.className = 'score';

                const hasScores = match[4] && match[5] && (match[4].trim() !== '' || match[5].trim() !== '');

                if (hasScores) {
                    const scoreValue = document.createElement('div');
                    scoreValue.className = 'score-value';
                    scoreValue.textContent = `${match[4] || '0'} : ${match[5] || '0'}`;
                    scoreDiv.appendChild(scoreValue);

                    if (match[6] && match[6].trim() !== '') {
                        const pointsDiv = document.createElement('div');
                        pointsDiv.className = 'points-details';
                        pointsDiv.textContent = match[6];
                        scoreDiv.appendChild(pointsDiv);
                    }
                } else {
                    const vsText = document.createElement('div');
                    vsText.textContent = 'vs';
                    scoreDiv.appendChild(vsText);

                    // Coming Up badge
                    const comingUpBadge = document.createElement('div');
                    comingUpBadge.className = 'coming-up-badge';
                    comingUpBadge.textContent = 'Coming Up';
                    matchDiv.appendChild(comingUpBadge);
                }

                matchDiv.appendChild(scoreDiv);

                // Team 2
                const team2Div = document.createElement('div');
                team2Div.className = 'team away';
                const team2Class = match[8] || '';
                const team2Name = match[7] || '';
                team2Div.textContent = team2Class && team2Name ? `${team2Class} - ${team2Name}` : team2Name;
                // Pod≈õwietl je≈õli to dru≈ºyna z aktualnej klasy
                if (team2Class === klasa) {
                    team2Div.style.background = 'rgba(67,97,238,0.18)';
                    team2Div.style.color = 'var(--dark)';
                    team2Div.style.fontWeight = 'bold';
                }
                matchDiv.appendChild(team2Div);

                // Match info
                const infoDiv = document.createElement('div');
                infoDiv.className = 'match-info';

                // Najpierw dzie≈Ñ (data z ikonkƒÖ), potem godzina (z ikonkƒÖ), na ko≈Ñcu boisko
                // Data
                const dateDiv = document.createElement('div');
                dateDiv.className = 'match-date';
                dateDiv.innerHTML = `
                    <svg class="icon" style="margin-right:2px;" xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                        <rect x="3" y="6" width="18" height="15" rx="2"></rect>
                        <line x1="16" y1="3" x2="16" y2="7"></line>
                        <line x1="8" y1="3" x2="8" y2="7"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    ${match[0]}
                `;
                infoDiv.appendChild(dateDiv);

                // Godzina
                const timeDiv = document.createElement('div');
                timeDiv.className = 'match-time';
                timeDiv.innerHTML = `
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    ${match[1]}
                `;
                infoDiv.appendChild(timeDiv);

                // Boisko
                if (match[9] && match[9].trim() !== '') {
                    const courtDiv = document.createElement('div');
                    courtDiv.className = 'match-location';
                    courtDiv.innerHTML = `
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                            <path d="M12 4v16"></path>
                            <path d="M2 8h20"></path>
                            <path d="M2 16h20"></path>
                        </svg>
                        Boisko ${match[9]}
                    `;
                    infoDiv.appendChild(courtDiv);
                }

                matchDiv.appendChild(infoDiv);

                container.appendChild(matchDiv);
            });
        }

        // === PLAN MECZ√ìW PI≈ÅKI NO≈ªNEJ ===
        function renderSoccerPlan(klasa, teams) {
            console.log(`%c[Teams] Rendering soccer matches for class: ${klasa}`, 'color: #4361ee');
            const teamsList = document.getElementById('teams-list');
            
            // Use the already fetched soccer data from window.soccerData
            const soccerData = window.soccerData || [];
            const matches = [];
            
            for (let i = 1; i < soccerData.length; i++) {
                const row = soccerData[i];
                if (!row || row.length < 9) continue;
                
                const mappedRow = [
                    row[1], // Data
                    row[2], // Godzina
                    row[3], // klasa team 1
                    row[4], // Team 1
                    row[5], // Wynik team 1
                    row[6], // Wynik team 2
                    '', // points (empty)
                    row[7], // Team 2
                    row[8], // klasa team 2
                    '', // court (empty)
                    row[9] || '' // Nag≈Ç√≥wek
                ];

                if (row[3] === klasa || row[8] === klasa) {
                    matches.push(mappedRow);
                }
            }

            if (matches.length > 0) {
                const soccerHeader = document.createElement('h2');
                soccerHeader.textContent = 'Mecze pi≈Çki no≈ºnej';
                soccerHeader.style.marginTop = '2.5rem';
                soccerHeader.style.marginBottom = '0.5rem';
                soccerHeader.style.color = 'var(--primary)';
                soccerHeader.style.fontSize = '1.3rem';
                teamsList.appendChild(soccerHeader);

                displaySoccerMatches(matches, teamsList, klasa);
            }
        }

        function displaySoccerMatches(matches, container, klasa) {
            console.log(`%c[Teams] Displaying ${matches.length} soccer matches for class ${klasa}`, 'color: #4361ee');
            
            // Sort matches by date and time
            matches.sort((a, b) => {
                const [dayA, monthA, yearA] = a[0].split('.').map(Number);
                const [dayB, monthB, yearB] = b[0].split('.').map(Number);
                const dateA = new Date(yearA, monthA-1, dayA);
                const dateB = new Date(yearB, monthB-1, dayB);
                if (dateA.getTime() !== dateB.getTime()) return dateA - dateB;
                const [hA, minA] = (a[1] || '').split(':').map(Number);
                const [hB, minB] = (b[1] || '').split(':').map(Number);
                return (hA * 60 + (minA || 0)) - (hB * 60 + (minB || 0));
            });

            matches.forEach(match => {
                // Indeksy: 0-data, 1-godzina, 2-klasa1, 3-dru≈ºyna1, 4-sets1, 5-sets2, 6-points, 7-dru≈ºyna2, 8-klasa2, 9-court, 10-header
                const matchDiv = document.createElement('div');
                matchDiv.className = 'match-container';
                matchDiv.setAttribute('data-date', match[0]);
                matchDiv.setAttribute('data-time', match[1]);

                // Nag≈Ç√≥wek meczu je≈õli istnieje
                if (match[10] && match[10].trim() !== '') {
                    const headerDiv = document.createElement('div');
                    headerDiv.className = 'match-header';
                    headerDiv.textContent = match[10];
                    matchDiv.appendChild(headerDiv);
                }

                // Team 1
                const team1Div = document.createElement('div');
                team1Div.className = 'team home';
                const team1Class = match[2] || '';
                const team1Name = match[3] || '';
                team1Div.textContent = team1Class && team1Name ? `${team1Class} - ${team1Name}` : team1Name;
                // Pod≈õwietl je≈õli to dru≈ºyna z aktualnej klasy
                if (team1Class === klasa) {
                    team1Div.style.background = 'rgba(67,97,238,0.18)';
                    team1Div.style.color = 'var(--dark)';
                    team1Div.style.fontWeight = 'bold';
                }
                matchDiv.appendChild(team1Div);

                // Score container
                const scoreDiv = document.createElement('div');
                scoreDiv.className = 'score';

                const hasScores = match[4] && match[5] && (match[4].trim() !== '' || match[5].trim() !== '');

                if (hasScores) {
                    const scoreValue = document.createElement('div');
                    scoreValue.className = 'score-value';
                    scoreValue.textContent = `${match[4] || '0'} : ${match[5] || '0'}`;
                    scoreDiv.appendChild(scoreValue);

                    if (match[6] && match[6].trim() !== '') {
                        const pointsDiv = document.createElement('div');
                        pointsDiv.className = 'points-details';
                        pointsDiv.textContent = match[6];
                        scoreDiv.appendChild(pointsDiv);
                    }
                } else {
                    const vsText = document.createElement('div');
                    vsText.textContent = 'vs';
                    scoreDiv.appendChild(vsText);

                    // Coming Up badge
                    const comingUpBadge = document.createElement('div');
                    comingUpBadge.className = 'coming-up-badge';
                    comingUpBadge.textContent = 'Coming Up';
                    matchDiv.appendChild(comingUpBadge);
                }

                matchDiv.appendChild(scoreDiv);

                // Team 2
                const team2Div = document.createElement('div');
                team2Div.className = 'team away';
                const team2Class = match[8] || '';
                const team2Name = match[7] || '';
                team2Div.textContent = team2Class && team2Name ? `${team2Class} - ${team2Name}` : team2Name;
                // Pod≈õwietl je≈õli to dru≈ºyna z aktualnej klasy
                if (team2Class === klasa) {
                    team2Div.style.background = 'rgba(67,97,238,0.18)';
                    team2Div.style.color = 'var(--dark)';
                    team2Div.style.fontWeight = 'bold';
                }
                matchDiv.appendChild(team2Div);

                // Match info
                const infoDiv = document.createElement('div');
                infoDiv.className = 'match-info';

                // Najpierw dzie≈Ñ (data z ikonkƒÖ), potem godzina (z ikonkƒÖ), na ko≈Ñcu boisko
                // Data
                const dateDiv = document.createElement('div');
                dateDiv.className = 'match-date';
                dateDiv.innerHTML = `
                    <svg class="icon" style="margin-right:2px;" xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                        <rect x="3" y="6" width="18" height="15" rx="2"></rect>
                        <line x1="16" y1="3" x2="16" y2="7"></line>
                        <line x1="8" y1="3" x2="8" y2="7"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    ${match[0]}
                `;
                infoDiv.appendChild(dateDiv);

                // Godzina
                const timeDiv = document.createElement('div');
                timeDiv.className = 'match-time';
                timeDiv.innerHTML = `
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    ${match[1]}
                `;
                infoDiv.appendChild(timeDiv);

                // Boisko
                if (match[9] && match[9].trim() !== '') {
                    const courtDiv = document.createElement('div');
                    courtDiv.className = 'match-location';
                    courtDiv.innerHTML = `
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                            <path d="M12 4v16"></path>
                            <path d="M2 8h20"></path>
                            <path d="M2 16h20"></path>
                        </svg>
                        Boisko ${match[9]}
                    `;
                    infoDiv.appendChild(courtDiv);
                }

                matchDiv.appendChild(infoDiv);

                container.appendChild(matchDiv);
            });
        }

function updateNavButtons() {
    document.getElementById('prev-class-btn').disabled = currentClassIdx <= 0;
    document.getElementById('next-class-btn').disabled = currentClassIdx >= classOrder.length - 1;
}

document.addEventListener('DOMContentLoaded', () => {
    loadTeams();
    document.getElementById('prev-class-btn').addEventListener('click', () => {
        if (currentClassIdx > 0) {
            currentClassIdx--;
            showCurrentClass();
        }
    });
    document.getElementById('next-class-btn').addEventListener('click', () => {
        if (currentClassIdx < classOrder.length - 1) {
            currentClassIdx++;
            showCurrentClass();
        }
    });
    document.getElementById('class-select').addEventListener('change', (e) => {
        const idx = parseInt(e.target.value, 10);
        if (!isNaN(idx) && idx >= 0 && idx < classOrder.length) {
            currentClassIdx = idx;
            showCurrentClass();
        }
    });
    
    // Handle URL parameter for class selection
    const urlParams = new URLSearchParams(window.location.search);
    const classParam = urlParams.get('class');
    
    if (classParam) {
        // Wait for teams to load
        const checkInterval = setInterval(() => {
            if (classOrder.length > 0) {
                clearInterval(checkInterval);
                // Find the index of the requested class
                const classIndex = classOrder.findIndex(c => c === classParam);
                if (classIndex !== -1) {
                    currentClassIdx = classIndex;
                    document.getElementById('class-select').value = classIndex;
                    showCurrentClass();
                }
            }
        }, 100);
    }
});

// Add at the very beginning of the file, after the last <script> tag:
console.log('%c[Teams] Script loaded', 'color: #4361ee; font-weight: bold');

// Add these functions before showCurrentClass()

function calculateTeamStats(klasa, teamName) {
    const stats = {
        volleyball: { played: 0, won: 0, lost: 0 },
        basketball: { played: 0, won: 0, lost: 0 },
        soccer: { played: 0, won: 0, lost: 0 },
        total: { played: 0, won: 0, lost: 0 }
    };

    // Calculate volleyball stats
    if (scheduleData && scheduleData.length > 0) {
        for (let i = 1; i < scheduleData.length; i++) {
            const match = scheduleData[i];
            if (!match || match.length < 9) continue;
            
            const isTeam1 = match[2] === klasa && match[3] === teamName;
            const isTeam2 = match[8] === klasa && match[7] === teamName;
            
            if (isTeam1 || isTeam2) {
                if (match[4] && match[5] && match[4].trim() !== '' && match[5].trim() !== '') {
                    stats.volleyball.played++;
                    const score1 = parseInt(match[4]) || 0;
                    const score2 = parseInt(match[5]) || 0;
                    if (isTeam1) {
                        if (score1 > score2) stats.volleyball.won++;
                        else stats.volleyball.lost++;
                    } else {
                        if (score2 > score1) stats.volleyball.won++;
                        else stats.volleyball.lost++;
                    }
                }
            }
        }
    }

    // Calculate basketball stats
    if (window.basketballData && window.basketballData.length > 0) {
        for (let i = 1; i < window.basketballData.length; i++) {
            const match = window.basketballData[i];
            if (!match || match.length < 6) continue;
            
            const [team1Class, team1Name] = (match[2] || '').split(' - ');
            const [team2Class, team2Name] = (match[5] || '').split(' - ');
            
            const isTeam1 = team1Class === klasa && team1Name === teamName;
            const isTeam2 = team2Class === klasa && team2Name === teamName;
            
            if (isTeam1 || isTeam2) {
                if (match[3] && match[4] && match[3].trim() !== '' && match[4].trim() !== '') {
                    stats.basketball.played++;
                    const score1 = parseInt(match[3]) || 0;
                    const score2 = parseInt(match[4]) || 0;
                    if (isTeam1) {
                        if (score1 > score2) stats.basketball.won++;
                        else stats.basketball.lost++;
                    } else {
                        if (score2 > score1) stats.basketball.won++;
                        else stats.basketball.lost++;
                    }
                }
            }
        }
    }

    // Calculate soccer stats
    if (window.soccerData && window.soccerData.length > 0) {
        for (let i = 1; i < window.soccerData.length; i++) {
            const match = window.soccerData[i];
            if (!match || match.length < 9) continue;
            
            const isTeam1 = match[3] === klasa && match[4] === teamName;
            const isTeam2 = match[8] === klasa && match[7] === teamName;
            
            if (isTeam1 || isTeam2) {
                if (match[5] && match[6] && match[5].trim() !== '' && match[6].trim() !== '') {
                    stats.soccer.played++;
                    const score1 = parseInt(match[5]) || 0;
                    const score2 = parseInt(match[6]) || 0;
                    if (isTeam1) {
                        if (score1 > score2) stats.soccer.won++;
                        else stats.soccer.lost++;
                    } else {
                        if (score2 > score1) stats.soccer.won++;
                        else stats.soccer.lost++;
                    }
                }
            }
        }
    }

    // Calculate totals
    stats.total.played = stats.volleyball.played + stats.basketball.played + stats.soccer.played;
    stats.total.won = stats.volleyball.won + stats.basketball.won + stats.soccer.won;
    stats.total.lost = stats.volleyball.lost + stats.basketball.lost + stats.soccer.lost;

    return stats;
}

function calculateTeamPoints(klasa, teamName) {
    const stats = calculateTeamStats(klasa, teamName);
    return {
        volleyball: stats.volleyball.won * 3,
        basketball: stats.basketball.won * 3,
        soccer: stats.soccer.won * 3,
        total: (stats.volleyball.won + stats.basketball.won + stats.soccer.won) * 3
    };
}

function getTeamPosition(klasa, teamName) {
    if (!window.mainTableData) return null;
    
    // Sort mainTableData by totalPoints in descending order
    const sortedData = [...window.mainTableData].sort((a, b) => {
        // First sort by total points descending
        if (b.totalPoints !== a.totalPoints) {
            return b.totalPoints - a.totalPoints;
        }
        // If points are equal, return 0 to keep original order
        return 0;
    });

    // Find position giving the same position for equal points
    let position = 1;
    let prevPoints = -1;

    for (let i = 0; i < sortedData.length; i++) {
        const team = sortedData[i];
        
        // If points are different from previous team, update position
        if (team.totalPoints !== prevPoints) {
            position = i + 1;
        }
        
        if (team.class === klasa && team.teamName === teamName) {
            return position;
        }
        
        prevPoints = team.totalPoints;
    }
    
    return null;
}
</script>
</body>
</html>
